{{ define "main" }}
<div class="blog-layout">
  {{ partial "blog/sidebar.html" . }}
  <div class="blog-content">
    <div class="blog-content-inner content">
      {{ partial "breadcrumb.html" . }}
      <div class="section-header">
        <h1 class="section-title-glitch" data-text="{{ .Title }}">{{ .Title }}</h1>
      </div>
      {{ .Content }}

      {{/* Separate sections (folders) from regular pages (posts) */}}
      {{ $sections := where .Pages ".IsSection" true }}
      {{ $pages := where .Pages ".IsSection" false }}

      {{/* Always show sub-sections first (no pagination) */}}
      {{ range $sections.ByWeight }}
        {{ if .Params.showList }}
        <article class="blog-list-item">
          <h2><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>
          <p class="blog-list-meta">{{ len .RegularPagesRecursive }} posts</p>
        </article>
        {{ end }}
      {{ end }}

      {{/* Paginate regular posts (only showList: true) */}}
      {{ $visiblePages := where $pages ".Params.showList" true }}
      {{ $paginator := .Paginate ($visiblePages.ByDate.Reverse) }}
      {{ range $paginator.Pages }}
      <article class="blog-list-item">
        <h2><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>
        <p class="blog-list-meta">{{ .Date.Format "2006-01-02" }}</p>
        {{ with .Description }}<p class="blog-list-desc">{{ . }}</p>{{ end }}
      </article>
      {{ end }}

      {{ partial "pagination.html" . }}
    </div>
  </div>
</div>

{{/* Mobile sidebar toggle */}}
<button class="sidebar-toggle" onclick="toggleSidebar()" aria-label="Toggle sidebar">
  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
</button>
{{ end }}
