{{ define "main" }}
<div class="blog-layout">
  {{ partial "blog/sidebar.html" . }}
  <div class="blog-content blog-content-single">
    <article class="blog-content-inner content">
      {{ partial "breadcrumb.html" . }}
      <header class="blog-post-header">
        <h1>{{ .Title }}</h1>
        <div class="blog-post-meta">
          <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "2006-01-02" }}</time>
          {{ with .Params.tags }}
            <span class="blog-post-tags">
              {{ range . }}
                <span class="tag">{{ . }}</span>
              {{ end }}
            </span>
          {{ end }}
        </div>
      </header>

      {{ .Content }}

      {{/* Prev/Next navigation */}}
      <nav class="blog-post-nav">
        {{ with .PrevInSection }}
          <a href="{{ .RelPermalink }}" class="post-nav-link post-nav-prev">
            <span class="post-nav-label">&larr; Previous</span>
            <span class="post-nav-title">{{ .Title }}</span>
          </a>
        {{ end }}
        {{ with .NextInSection }}
          <a href="{{ .RelPermalink }}" class="post-nav-link post-nav-next">
            <span class="post-nav-label">Next &rarr;</span>
            <span class="post-nav-title">{{ .Title }}</span>
          </a>
        {{ end }}
      </nav>

      {{/* Comments â€” Remark42 first, Giscus fallback */}}
      {{ if .Site.Params.remark42.url }}
      <section class="blog-comments">
        <h2 class="comments-title">Comments</h2>
        <div id="remark42"></div>
        <script>
          var remark_config = {
            host: '{{ .Site.Params.remark42.url }}',
            site_id: '{{ .Site.Params.remark42.site | default "blog" }}',
            theme: document.documentElement.dataset.theme === 'dark' ? 'dark' : 'light',
            locale: '{{ .Site.Params.remark42.locale | default "ko" }}'
          };
          (function() {
            var s = document.createElement('script');
            s.src = remark_config.host + '/web/embed.es6.mjs';
            s.type = 'module'; s.defer = true;
            (document.head || document.body).appendChild(s);
          })();
        </script>
      </section>
      {{ else }}
      {{ with .Site.Params.giscus }}
      {{ if and .repo .repoId .categoryId }}
      <section class="blog-comments">
        <h2 class="comments-title">Comments</h2>
        <div class="giscus-container"></div>
        <script>
          (function() {
            var theme = document.documentElement.dataset.theme === 'dark' ? 'dark' : 'light';
            var s = document.createElement('script');
            s.src = 'https://giscus.app/client.js';
            s.setAttribute('data-repo', '{{ .repo }}');
            s.setAttribute('data-repo-id', '{{ .repoId }}');
            s.setAttribute('data-category', '{{ .category | default "Announcements" }}');
            s.setAttribute('data-category-id', '{{ .categoryId }}');
            s.setAttribute('data-mapping', '{{ .mapping | default "pathname" }}');
            s.setAttribute('data-strict', '0');
            s.setAttribute('data-reactions-enabled', '1');
            s.setAttribute('data-emit-metadata', '0');
            s.setAttribute('data-input-position', 'top');
            s.setAttribute('data-theme', theme);
            s.setAttribute('data-lang', '{{ .lang | default "ko" }}');
            s.setAttribute('data-loading', 'lazy');
            s.setAttribute('crossorigin', 'anonymous');
            s.async = true;
            document.querySelector('.blog-comments .giscus-container').appendChild(s);
          })();
        </script>
      </section>
      {{ end }}
      {{ end }}
      {{ end }}
    </article>
  </div>
  {{ partial "blog/toc.html" . }}
</div>

{{/* Mobile sidebar toggle */}}
<button class="sidebar-toggle" onclick="toggleSidebar()" aria-label="Toggle sidebar">
  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
</button>
{{ end }}
