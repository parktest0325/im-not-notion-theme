{{ define "main" }}
<div class="projects-page">
  <div class="projects-header">
    <h1 class="projects-title" data-text="Projects">Projects</h1>
    <p class="projects-subtitle">{{ .Description | default "Game dev, OS, security, and more." }}</p>

    {{/* Filter buttons */}}
    <div class="project-filters">
      <div class="filter-group">
        <button class="filter-btn filter-btn--status active" data-status="all">All</button>
        <button class="filter-btn filter-btn--status" data-status="active">Active</button>
        <button class="filter-btn filter-btn--status" data-status="completed">Completed</button>
        <button class="filter-btn filter-btn--status" data-status="archived">Archived</button>
      </div>
      <div class="filter-group">
        <button class="filter-btn filter-btn--tag active" data-filter="all">All</button>
        {{ $allTags := slice }}
        {{ range .Pages }}
          {{ if .Params.showList }}
          {{ with .Params.tags }}
            {{ range . }}
              {{ $allTags = $allTags | append . }}
            {{ end }}
          {{ end }}
          {{ end }}
        {{ end }}
        {{ range uniq $allTags }}
          <button class="filter-btn filter-btn--tag" data-filter="{{ . }}">{{ . }}</button>
        {{ end }}
      </div>
    </div>
  </div>

  <div class="project-grid">
    {{ range .Pages.ByWeight }}
      {{ if .Params.showList }}
      {{ partial "projects/card.html" . }}
      {{ end }}
    {{ end }}
  </div>
</div>

{{ partial "projects/modal.html" . }}

<script>
  (function() {
    var activeStatus = 'all';
    var activeTag = 'all';

    function applyFilters() {
      document.querySelectorAll('.project-card').forEach(function(card) {
        var statusMatch = activeStatus === 'all' || card.dataset.status === activeStatus;
        var tagMatch = activeTag === 'all' || (card.dataset.tags || '').split(',').indexOf(activeTag) >= 0;
        card.style.display = (statusMatch && tagMatch) ? '' : 'none';
      });
    }

    // Status filter
    document.querySelectorAll('.filter-btn--status').forEach(function(btn) {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.filter-btn--status').forEach(function(b) { b.classList.remove('active'); });
        btn.classList.add('active');
        activeStatus = btn.dataset.status;
        applyFilters();
      });
    });

    // Tag filter
    document.querySelectorAll('.filter-btn--tag').forEach(function(btn) {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.filter-btn--tag').forEach(function(b) { b.classList.remove('active'); });
        btn.classList.add('active');
        activeTag = btn.dataset.filter;
        applyFilters();
      });
    });
  })();
</script>
{{ end }}
